<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Password Property Test</title>
</head>
<body>
    <h1>Test navigator.credentials.get() for passwords</h1>

    <div>
        <input type="checkbox" id="passwordToggle">
        <label for="passwordToggle">Set <code>password: true</code> (if unchecked, will be <code>false</code>)</label>
    </div>
    <div>
        <label for="mediationSelect">Mediation:</label>
        <select id="mediationSelect">
            <option value="">-- Not set --</option>
            <option value="required">required</option>
            <option value="optional">optional</option>
            <option value="silent">silent</option>
        </select>
    </div>

    <br>

    <button id="testButton">Run Test</button>

    <h2>Output:</h2>
    <pre id="output" style="background-color: #f0f0f0; border: 1px solid #ccc; padding: 10px; min-height: 50px;"></pre>

    <script>
        const passwordToggle = document.getElementById('passwordToggle');
        const mediationSelect = document.getElementById('mediationSelect');
        const testButton = document.getElementById('testButton');
        const output = document.getElementById('output');

        function log(message) {
            output.textContent += message + '\n';
        }

        testButton.addEventListener('click', async () => {
            output.textContent = ''; // Clear previous output
            const getOptions = {};

            // If checked, password is true. If not, it's false.
            getOptions.password = passwordToggle.checked;

            const mediationValue = mediationSelect.value;
            if (mediationValue) {
                getOptions.mediation = mediationValue;
            }

            log(`Calling navigator.credentials.get() with options:`);
            log(JSON.stringify(getOptions, null, 2));
            log('---');

            try {
                const credential = await navigator.credentials.get(getOptions);
                console.log(credential);
                log("Success!");
                log(JSON.stringify(credential, (key, value) => {
                    if (value instanceof ArrayBuffer) {
                        return `[ArrayBuffer of length ${value.byteLength}]`;
                    }
                    return value;
                }, 2));
            } catch (error) {
                log(`Error: [${error.name}] ${error.message}`);
            }
        });
    </script>
</body>
</html>